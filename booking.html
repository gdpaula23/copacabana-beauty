<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Checkout | Copacabana Beauty</title>

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">

<style>
:root{
  --olive-900:#2F3A22;
  --olive-800:#3F4D2F;
  --olive-700:#5A6643;

  --beige:#F4EAD6;
  --beige-40: rgba(244,234,214,.40);
  --beige-22: rgba(244,234,214,.22);
  --beige-14: rgba(244,234,214,.14);

  --glass: rgba(0,0,0,.18);
  --glass-2: rgba(0,0,0,.14);

  --shadow: 0 40px 90px rgba(0,0,0,.32);
  --radius-xl: 22px;
  --radius-lg: 18px;
}

/* RESET */
*{margin:0;padding:0;box-sizing:border-box}

/* FUNDO */
body{
  font-family:'Montserrat',sans-serif;
  color:var(--beige);
  overflow-x:hidden;
}

.page{
  min-height:100vh;
  background:
    radial-gradient(circle at 18% 18%, rgba(244,234,214,.12), transparent 65%),
    radial-gradient(circle at 78% 12%, rgba(244,234,214,.08), transparent 68%),
    radial-gradient(circle at 55% 78%, rgba(244,234,214,.07), transparent 72%),
    linear-gradient(180deg, var(--olive-800) 0%, var(--olive-900) 100%);
}

/* container central */
.wrap{
  max-width:1100px;
  margin:0 auto;
  padding:46px 18px 70px;
}

/* topo */
.header{
  text-align:center;
  padding:12px 0 26px;
}

.header h1{
  font-family:'Cormorant Garamond',serif;
  font-size:56px;
  letter-spacing:.2px;
  text-shadow:0 14px 34px rgba(0,0,0,.25);
}

.header p{
  max-width:760px;
  margin:10px auto 0;
  font-size:15px;
  opacity:.86;
  line-height:1.7;
}

/* CARD MASTER */
.shell{
  margin-top:26px;
  padding:22px;
  border-radius: var(--radius-xl);
  border:1px solid rgba(244,234,214,.18);
  background:
    linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)),
    rgba(244,234,214,.10);
  backdrop-filter: blur(16px);
  box-shadow: var(--shadow);
}

/* GRID 2 COLUNAS */
.grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:22px;
  align-items:stretch;
}

/* bloco interno */
.panel{
  border-radius: var(--radius-xl);
  background: rgba(0,0,0,.14);
  border:1px solid rgba(244,234,214,.16);
  padding:20px;
}

.panel-title{
  font-size:12px;
  letter-spacing:2px;
  text-transform:uppercase;
  opacity:.78;
  margin-bottom:14px;
}

/* inputs */
.field{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-bottom:14px;
}

.field label{
  font-size:11px;
  letter-spacing:2px;
  text-transform:uppercase;
  opacity:.75;
}

.field input{
  width:100%;
  padding:12px 12px;
  border-radius:14px;
  border:1px solid rgba(244,234,214,.20);
  background: rgba(0,0,0,.20);
  color: var(--beige);
  outline:none;
}

.field input::placeholder{color: rgba(244,234,214,.55);}

/* alerta */
.notice{
  margin:10px 0 16px;
  padding:12px 12px;
  border-radius:14px;
  border:1px solid rgba(244,234,214,.18);
  background: rgba(0,0,0,.20);
  opacity:.92;
  font-size:13px;
  line-height:1.6;
}

/* botões */
.btns{display:flex;flex-direction:column;gap:12px;margin-top:10px;}

.btn{
  width:100%;
  border:none;
  cursor:pointer;
  padding:13px 16px;
  border-radius:999px;
  font-size:12px;
  letter-spacing:2px;
  text-transform:uppercase;
  transition:.18s ease;
}

.btn-primary{
  background: var(--beige);
  color: var(--olive-900);
}
.btn-primary:hover{transform:translateY(-1px);}

.btn-ghost{
  background: transparent;
  color: var(--beige);
  border:1px solid rgba(244,234,214,.35);
}
.btn-ghost:hover{background: rgba(244,234,214,.10);}

.btn-muted{
  background: rgba(0,0,0,.22);
  color: rgba(244,234,214,.85);
  border:1px solid rgba(244,234,214,.18);
}
.btn-muted:hover{background: rgba(0,0,0,.28);}

.btn[disabled]{opacity:.45;cursor:not-allowed;transform:none}

/* card resumo direito (branco/bege como na imagem) */
.summary{
  background: rgba(244,234,214,.96);
  color: #2b2b2b;
  border-radius: var(--radius-xl);
  padding:20px;
  border:1px solid rgba(255,255,255,.65);
}

.sum-row{
  display:flex;
  justify-content:space-between;
  gap:14px;
  padding:10px 0;
  font-size:14px;
  opacity:.92;
  border-bottom:1px solid rgba(0,0,0,.08);
}

.sum-row:last-of-type{border-bottom:none;}

.sum-strong{
  margin-top:6px;
  padding-top:10px;
  font-weight:600;
  font-size:16px;
}

.sum-strong span:last-child{font-size:18px;}

.service-chip{
  margin-top:14px;
  border-radius:14px;
  border:1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.50);
  padding:14px;
}

.service-chip .name{
  font-family:'Cormorant Garamond',serif;
  font-size:20px;
  margin-bottom:4px;
}

.service-chip .meta{
  font-size:12px;
  letter-spacing:2px;
  text-transform:uppercase;
  opacity:.6;
}

.service-chip .value{
  margin-top:6px;
  font-size:13px;
  opacity:.85;
}

/* booking info */
.booking-mini{
  margin-top:14px;
  border-radius:14px;
  background: rgba(0,0,0,.12);
  border:1px solid rgba(0,0,0,.10);
  padding:12px;
  font-size:13px;
  line-height:1.55;
  opacity:.92;
}

/* footer tip */
.tip{
  margin-top:14px;
  text-align:center;
  font-size:12px;
  opacity:.65;
}

/* responsive */
@media (max-width: 980px){
  .header h1{font-size:46px;}
  .grid{grid-template-columns:1fr;}
  .shell{padding:18px;}
}
@media (max-width: 420px){
  .header h1{font-size:40px;}
}
</style>
</head>

<body>
<div class="page">
  <div class="wrap">

    <header class="header">
      <h1>Checkout</h1>
      <p>Pay a £20 deposit to secure your appointment. The remaining balance is paid on the day of your service.</p>
    </header>

    <section class="shell">
      <div class="grid">

        <!-- LEFT -->
        <div class="panel">
          <div class="panel-title">Customer details</div>

          <div class="field">
            <label for="fullName">Full name</label>
            <input id="fullName" type="text" placeholder="Your name" autocomplete="name">
          </div>

          <div class="field">
            <label for="email">Email</label>
            <input id="email" type="email" placeholder="you@email.com" autocomplete="email">
          </div>

          <div id="statusBox" class="notice">
            Click <b>Pay £20 deposit</b> to open Stripe. After paying, come back and click <b>I've paid</b>.
          </div>

          <div class="btns">
            <button class="btn btn-primary" id="payBtn" type="button">Pay £20 deposit</button>
            <button class="btn btn-ghost" id="paidBtn" type="button">I’ve paid — Continue</button>
            <button class="btn btn-muted" id="backBtn" type="button">Back to booking</button>
          </div>

          <div class="tip">Tip: after you finish the Stripe payment, return here and tap “I’ve paid”.</div>
        </div>

        <!-- RIGHT -->
        <div class="summary">
          <div class="sum-row">
            <span>Subtotal</span>
            <span id="sumSubtotal">£150</span>
          </div>
          <div class="sum-row">
            <span>Deposit today</span>
            <span id="sumDeposit">£20</span>
          </div>
          <div class="sum-row">
            <span>Remaining on appointment day</span>
            <span id="sumRemaining">£130</span>
          </div>

          <div class="sum-row sum-strong" style="border-bottom:none;">
            <span>Total (full service value)</span>
            <span id="sumTotal">£150</span>
          </div>

          <div class="service-chip">
            <div class="name" id="serviceName">Head Spa & Facial</div>
            <div class="meta">Service selected</div>
            <div class="value">Value: <b id="serviceValue">£150</b></div>

            <div class="booking-mini" id="bookingMini" style="display:none;"></div>
          </div>
        </div>

      </div>
    </section>

  </div>
</div>

<script>
/**
 * CONFIG
 * Coloque seu Stripe Payment Link aqui (depósito £20).
 * Exemplo: https://buy.stripe.com/xxxxxxx
 */
const STRIPE_PAYMENT_LINK = "https://buy.stripe.com/test_cNi9ANbUj8J38Ps9tpcbC00";

/**
 * Storage keys
 */
const BOOKING_KEY = "cb_booking_v1";
const CART_KEY = "cb_cart_v1";

/**
 * Helpers
 */
function moneyGBP(value){
  const n = Number(value || 0);
  return "£" + n.toFixed(0);
}

function loadJSON(key){
  try { return JSON.parse(localStorage.getItem(key) || "null"); }
  catch { return null; }
}

/**
 * Get service info (best effort):
 * - If you have cart data, use the first item as selected service
 * - else use defaults
 */
function getServiceFromCart(){
  const cart = loadJSON(CART_KEY);
  if (!Array.isArray(cart) || !cart.length) return null;

  // tenta ler um formato comum: {name, price, qty}
  const item = cart[0];
  const name = item?.name || item?.title || "Service";
  const price = Number(item?.price || item?.value || 150);
  const qty = Number(item?.qty || 1);
  return { name, price, qty, subtotal: price * qty };
}

function getBooking(){
  const b = loadJSON(BOOKING_KEY);
  if (!b) return null;
  return b;
}

/**
 * UI init
 */
const el = {
  fullName: document.getElementById("fullName"),
  email: document.getElementById("email"),
  statusBox: document.getElementById("statusBox"),

  payBtn: document.getElementById("payBtn"),
  paidBtn: document.getElementById("paidBtn"),
  backBtn: document.getElementById("backBtn"),

  sumSubtotal: document.getElementById("sumSubtotal"),
  sumDeposit: document.getElementById("sumDeposit"),
  sumRemaining: document.getElementById("sumRemaining"),
  sumTotal: document.getElementById("sumTotal"),

  serviceName: document.getElementById("serviceName"),
  serviceValue: document.getElementById("serviceValue"),
  bookingMini: document.getElementById("bookingMini"),
};

const DEPOSIT = 20;

// preenche resumo
(function initSummary(){
  const service = getServiceFromCart() || { name: "Head Spa & Facial", subtotal: 150 };
  const total = Number(service.subtotal || 150);
  const remaining = Math.max(0, total - DEPOSIT);

  el.serviceName.textContent = service.name;
  el.serviceValue.textContent = moneyGBP(total);

  el.sumSubtotal.textContent = moneyGBP(total);
  el.sumDeposit.textContent = moneyGBP(DEPOSIT);
  el.sumRemaining.textContent = moneyGBP(remaining);
  el.sumTotal.textContent = moneyGBP(total);

  // booking mini (staff/date/time)
  const booking = getBooking();
  if (booking){
    const when = (booking.date ? booking.date : "") + (booking.label ? (" · " + booking.label) : "");
    el.bookingMini.style.display = "block";
    el.bookingMini.innerHTML =
      `<b>Appointment</b><br>` +
      `${booking.staffName || "Staff"}<br>` +
      `${when || ""}<br>` +
      `<span style="opacity:.8;">Duration: ${booking.durationMin || 60} min</span>`;
  }
})();

// Botões
el.payBtn.addEventListener("click", () => {
  if (!STRIPE_PAYMENT_LINK || STRIPE_PAYMENT_LINK.includes("COLE_AQUI")){
    el.statusBox.innerHTML = "⚠️ Add your Stripe payment link in <b>STRIPE_PAYMENT_LINK</b> first.";
    return;
  }

  // (Opcional) você pode adicionar querystring no link com nome/email depois,
  // mas payment links não aceitam metadata direto. Isso a gente resolve com Checkout Session depois.
  window.open(STRIPE_PAYMENT_LINK, "_blank", "noopener");
  el.statusBox.innerHTML = "Stripe opened. After paying, come back and click <b>I’ve paid — Continue</b>.";
});

el.paidBtn.addEventListener("click", () => {
  // por enquanto, só segue para success.html (ou qualquer página)
  // depois a gente troca isso para: confirmar pagamento via webhook + criar evento no calendário.
  window.location.href = "success.html";
});

el.backBtn.addEventListener("click", () => {
  window.location.href = "booking.html";
});
</script>

</body>
</html>
